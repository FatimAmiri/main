
<!DOCTYPE html>

<html lang="en">
<head>
<title>compas -- a computational framework for research in architecture and structures</title>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
<meta content="Tom Van Mele" name="author"/>
<meta content="compas is a computational framework for research in architecture and structures." name="description"/>
<link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" rel="stylesheet"/>
<link href="/css/github.css" rel="stylesheet" type="text/css"/>
<link href="/css/compas.css" rel="stylesheet" type="text/css"/>
<link href="/css/compas-reference.css" rel="stylesheet" type="text/css"/>
<link href="../day2.html" rel="next" title="Day 2"/>
<link href="python.html" rel="prev" title="Python"/>
<script async="" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript"></script>
</head>
<body data-spy="scroll" data-target="#compas-localnav">
<header class="navbar navbar-expand navbar-dark bg-dark compas-navbar">
<a class="navbar-brand" href="/">compas</a>
<ul class="navbar-nav">
<li class="nav-item">
<a class="nav-link active" href="/main/">Main library</a>
</li>
<li class="nav-item">
<a class="nav-link" href="/packages/">Additional Packages</a>
</li>
</ul>
</header>
<div class="container-fluid compas-container">
<div class="row flex-xl-nowrap">
<main class="col-12 col-md-9 col-xl-8 compas-content" role="main">
<nav class="breadcrumb">
<a class="breadcrumb-item" href="https://compas-dev.github.io/">compas</a>
<a class="breadcrumb-item" href="https://compas-dev.github.io/compas/index.html">main library</a>
<a class="breadcrumb-item" href="../../../workshops.html">workshops</a>
<a class="breadcrumb-item" href="../../acadia2017.html">acadia 2017</a>
<a accesskey="U" class="breadcrumb-item" href="../day1.html">day 1</a>
</nav>
<div class="section">
<span id="acadia2017-day1-datastructures"></span><h1>Datastructures</h1>
<div class="section">
<h2>Network, Mesh, VolMesh</h2>
<p>The <em>compas</em> framework contains three types of data structures and related operations and algorithms:</p>
<ul class="simple">
<li><a class="reference internal" href="../../../reference/generated/compas.datastructures.Network.html#compas.datastructures.Network" title="compas.datastructures.Network"><code class="xref py py-class docutils literal">compas.datastructures.Network</code></a></li>
<li><a class="reference internal" href="../../../reference/generated/compas.datastructures.Mesh.html#compas.datastructures.Mesh" title="compas.datastructures.Mesh"><code class="xref py py-class docutils literal">compas.datastructures.Mesh</code></a></li>
<li><a class="reference internal" href="../../../reference/generated/compas.datastructures.VolMesh.html#compas.datastructures.VolMesh" title="compas.datastructures.VolMesh"><code class="xref py py-class docutils literal">compas.datastructures.VolMesh</code></a></li>
</ul>
<p>For this tutorial, we will focus on the mesh data structure.</p>
<div class="highlight"><pre><code class="language-python border rounded"><span></span><span class="kn">import</span> <span class="nn">compas</span>
<span class="kn">from</span> <span class="nn">compas.datastructures</span> <span class="kn">import</span> <span class="n">Mesh</span>
<span class="kn">from</span> <span class="nn">compas.plotters</span> <span class="kn">import</span> <span class="n">MeshPlotter</span>

<span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_obj</span><span class="p">(</span><span class="n">compas</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'faces.obj'</span><span class="p">))</span>

<span class="n">plotter</span> <span class="o">=</span> <span class="n">MeshPlotter</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>

<span class="n">plotter</span><span class="o">.</span><span class="n">draw_vertices</span><span class="p">()</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">draw_faces</span><span class="p">()</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">draw_edges</span><span class="p">()</span>

<span class="n">plotter</span><span class="o">.</span><span class="n">draw_vertices</span><span class="p">(</span>
    <span class="n">text</span><span class="o">=</span><span class="s1">'key'</span><span class="p">,</span>
    <span class="n">radius</span><span class="o">=</span><span class="mf">0.15</span>
<span class="p">)</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">draw_faces</span><span class="p">(</span>
    <span class="n">text</span><span class="o">=</span><span class="s1">'key'</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">draw_edges</span><span class="p">(</span>
    <span class="n">text</span><span class="o">=</span><span class="s1">'key'</span>
<span class="p">)</span>

<span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<figure class="figure">
<img alt="../../../images/datastructures-11.png" class="figure-img img-fluid" src="../../../images/datastructures-11.png"/>
</figure>
</div>
<div class="section">
<h2>Construction</h2>
<p>All datastructures come with factory constructors.
These are implemented as class methods (using the <code class="docutils literal">@classmethod</code> decoreator) and
are named using the following pattern <code class="docutils literal">.from_xxx</code>.</p>
<div class="highlight"><pre><code class="language-python border rounded"><span></span><span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_data</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_obj</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_vertices_and_faces</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_polygons</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_polyhedron</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_points</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</code></pre></div>

<p><code class="docutils literal">compas</code> also provides basic sample data that can be used together with the constructors.</p>
<div class="highlight"><pre><code class="language-python border rounded"><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">compas</span>
<span class="kn">from</span> <span class="nn">compas.datastructures</span> <span class="kn">import</span> <span class="n">Mesh</span>

<span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_obj</span><span class="p">(</span><span class="n">compas</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'faces.obj'</span><span class="p">))</span>

<span class="k">print</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>

<span class="c1"># ================================================================================</span>
<span class="c1"># Mesh summary</span>
<span class="c1"># ================================================================================</span>
<span class="c1">#</span>
<span class="c1"># - name: Mesh</span>
<span class="c1"># - vertices: 36</span>
<span class="c1"># - edges: 60</span>
<span class="c1"># - faces: 25</span>
<span class="c1"># - vertex degree: 2/4</span>
<span class="c1"># - face degree: 2/4</span>
<span class="c1">#</span>
<span class="c1"># ================================================================================</span>
</code></pre></div>

<p>Printing the mesh produces a summary of the meshâ€™s properties:
the number of vertices, edges and faces and information about vertex and face degree.</p>
</div>
<div class="section">
<h2>Access</h2>
<p>All data <em>accessors</em> are iterators; they are meant to be iterated over.
Lists of data have to be constructed explicitly.</p>
<ul class="simple">
<li>mesh.vertices()</li>
<li>mesh.faces()</li>
<li>mesh.halfedges()</li>
<li>mesh.edges()</li>
</ul>
<div class="highlight"><pre><code class="language-python border rounded"><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">compas</span>
<span class="kn">from</span> <span class="nn">compas.datastructures</span> <span class="kn">import</span> <span class="n">Mesh</span>

<span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_obj</span><span class="p">(</span><span class="n">compas</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'faces.obj'</span><span class="p">))</span>

<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">(</span><span class="bp">True</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">()))</span>
<span class="k">print</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">number_of_vertices</span><span class="p">())</span>
</code></pre></div>

<div class="highlight"><pre><code class="language-python border rounded"><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">compas</span>
<span class="kn">from</span> <span class="nn">compas.datastructures</span> <span class="kn">import</span> <span class="n">Mesh</span>

<span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_obj</span><span class="p">(</span><span class="n">compas</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'faces.obj'</span><span class="p">))</span>

<span class="k">for</span> <span class="n">fkey</span> <span class="ow">in</span> <span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="n">fkey</span><span class="p">)</span>

<span class="k">for</span> <span class="n">fkey</span><span class="p">,</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">(</span><span class="bp">True</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">fkey</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">()))</span>
<span class="k">print</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">number_of_faces</span><span class="p">())</span>
</code></pre></div>

</div>
<div class="section">
<h2>Topology</h2>
<ul class="simple">
<li>mesh.is_valid()</li>
<li>mesh.is_regular()</li>
<li>mesh.is_connected()</li>
<li>mesh.is_manifold()</li>
<li>mesh.is_orientable()</li>
<li>mesh.is_trimesh()</li>
<li>mesh.is_quadmesh()</li>
<li>mesh.vertex_neighbours()</li>
<li>mesh.vertex_degree()</li>
<li>mesh.vertex_faces()</li>
<li>mesh.vertex_neighbourhood()</li>
<li>mesh.face_vertices()</li>
<li>mesh.face_halfedges()</li>
<li>mesh.face_neighbours()</li>
<li>mesh.face_neighbourhood()</li>
<li>mesh.face_vertex_ancestor()</li>
<li>mesh.face_vertex_descendant()</li>
</ul>
<div class="highlight"><pre><code class="language-python border rounded"><span></span><span class="kn">import</span> <span class="nn">compas</span>
<span class="kn">from</span> <span class="nn">compas.datastructures</span> <span class="kn">import</span> <span class="n">Mesh</span>
<span class="kn">from</span> <span class="nn">compas.plotters</span> <span class="kn">import</span> <span class="n">MeshPlotter</span>

<span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_obj</span><span class="p">(</span><span class="n">compas</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'faces.obj'</span><span class="p">))</span>

<span class="n">plotter</span> <span class="o">=</span> <span class="n">MeshPlotter</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>

<span class="n">root</span> <span class="o">=</span> <span class="mi">17</span>
<span class="n">nbrs</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vertex_neighbours</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">text</span> <span class="o">=</span> <span class="p">{</span><span class="n">nbr</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">nbr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nbrs</span><span class="p">)}</span>
<span class="n">text</span><span class="p">[</span><span class="n">root</span><span class="p">]</span> <span class="o">=</span> <span class="n">root</span>

<span class="n">facecolor</span> <span class="o">=</span> <span class="p">{</span><span class="n">nbr</span><span class="p">:</span> <span class="s1">'#cccccc'</span> <span class="k">for</span> <span class="n">nbr</span> <span class="ow">in</span> <span class="n">nbrs</span><span class="p">}</span>
<span class="n">facecolor</span><span class="p">[</span><span class="n">root</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'#ff0000'</span>

<span class="n">plotter</span><span class="o">.</span><span class="n">draw_vertices</span><span class="p">(</span>
    <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
    <span class="n">facecolor</span><span class="o">=</span><span class="n">facecolor</span><span class="p">,</span>
    <span class="n">radius</span><span class="o">=</span><span class="mf">0.15</span>
<span class="p">)</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">draw_faces</span><span class="p">()</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">draw_edges</span><span class="p">()</span>

<span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<figure class="figure">
<img alt="../../../images/datastructures-2.png" class="figure-img img-fluid" src="../../../images/datastructures-2.png"/>
</figure>
</div>
<div class="section">
<h2>Geometry</h2>
<ul class="simple">
<li>mesh.vertex_coordinates()</li>
<li>mesh.vertex_area()</li>
<li>mesh.vertex_centroid()</li>
<li>mesh.vertex_normal()</li>
<li>mesh.face_coordinates()</li>
<li>mesh.face_area()</li>
<li>mesh.face_centroid()</li>
<li>mesh.face_center()</li>
<li>mesh.face_normal()</li>
<li>mesh.face_flatness()</li>
<li>mesh.edge_coordinates()</li>
<li>mesh.edge_vector()</li>
<li>mesh.edge_direction()</li>
<li>mesh.edge_length()</li>
<li>mesh.edge_midpoint()</li>
</ul>
<div class="highlight"><pre><code class="language-python border rounded"><span></span><span class="kn">import</span> <span class="nn">compas</span>
<span class="kn">from</span> <span class="nn">compas.datastructures</span> <span class="kn">import</span> <span class="n">Mesh</span>
<span class="kn">from</span> <span class="nn">compas.plotters</span> <span class="kn">import</span> <span class="n">MeshPlotter</span>

<span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_obj</span><span class="p">(</span><span class="n">compas</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'faces.obj'</span><span class="p">))</span>

<span class="n">plotter</span> <span class="o">=</span> <span class="n">MeshPlotter</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>

<span class="n">plotter</span><span class="o">.</span><span class="n">draw_vertices</span><span class="p">()</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">draw_faces</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="p">{</span><span class="n">fkey</span><span class="p">:</span> <span class="s1">'</span><span class="si">%.1f</span><span class="s1">'</span> <span class="o">%</span> <span class="n">mesh</span><span class="o">.</span><span class="n">face_area</span><span class="p">(</span><span class="n">fkey</span><span class="p">)</span> <span class="k">for</span> <span class="n">fkey</span> <span class="ow">in</span> <span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">()})</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">draw_edges</span><span class="p">()</span>

<span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<figure class="figure">
<img alt="../../../images/datastructures-3.png" class="figure-img img-fluid" src="../../../images/datastructures-3.png"/>
</figure>
</div>
<div class="section">
<h2>Algorithms</h2>
<ul class="simple">
<li><a class="reference internal" href="../../../reference/generated/compas.topology.trimesh_remesh.html#compas.topology.trimesh_remesh" title="compas.topology.trimesh_remesh"><code class="xref py py-func docutils literal">compas.topology.trimesh_remesh()</code></a></li>
</ul>
<div class="highlight"><pre><code class="language-python border rounded"><span></span><span class="c1"># mesh remeshing</span>

<span class="kn">from</span> <span class="nn">compas.datastructures</span> <span class="kn">import</span> <span class="n">Mesh</span>
<span class="kn">from</span> <span class="nn">compas.plotters</span> <span class="kn">import</span> <span class="n">MeshPlotter</span>

<span class="kn">from</span> <span class="nn">compas.topology</span> <span class="kn">import</span> <span class="n">trimesh_remesh</span>


<span class="c1"># make a square</span>
<span class="c1"># and insert a vertex in the middle</span>
<span class="c1"># to create a triangle mesh</span>

<span class="n">vertices</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)]</span>
<span class="n">faces</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>

<span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_vertices_and_faces</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">faces</span><span class="p">)</span>

<span class="n">mesh</span><span class="o">.</span><span class="n">insert_vertex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<span class="c1"># create a plotter for visualization</span>
<span class="c1"># draw the initial mesh as edges</span>
<span class="c1"># define a callback to update the edges during the algorithm</span>

<span class="n">plotter</span> <span class="o">=</span> <span class="n">MeshPlotter</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>

<span class="n">plotter</span><span class="o">.</span><span class="n">draw_edges</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">callback</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="n">plotter</span><span class="o">.</span><span class="n">update_edges</span><span class="p">()</span>
    <span class="n">plotter</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">pause</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>


<span class="c1"># run the remeshing algorithm</span>
<span class="c1"># visualize the end result</span>
<span class="c1"># with faces and edges</span>

<span class="n">trimesh_remesh</span><span class="p">(</span>
    <span class="n">mesh</span><span class="p">,</span>
    <span class="mf">0.5</span><span class="p">,</span>
    <span class="n">tol</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span>
    <span class="n">kmax</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">allow_boundary_split</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">allow_boundary_swap</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">allow_boundary_collapse</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">fixed</span><span class="o">=</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices_on_boundary</span><span class="p">(),</span>
    <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">)</span>

<span class="n">plotter</span><span class="o">.</span><span class="n">clear_edges</span><span class="p">()</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

<span class="n">plotter</span><span class="o">.</span><span class="n">draw_faces</span><span class="p">()</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">draw_edges</span><span class="p">()</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

<span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<ul class="simple">
<li><a class="reference internal" href="../../../reference/generated/compas.topology.trimesh_remesh.html#compas.topology.trimesh_remesh" title="compas.topology.trimesh_remesh"><code class="xref py py-func docutils literal">compas.topology.trimesh_remesh()</code></a></li>
<li><a class="reference internal" href="../../../reference/generated/compas.topology.delaunay_from_points.html#compas.topology.delaunay_from_points" title="compas.topology.delaunay_from_points"><code class="xref py py-func docutils literal">compas.topology.delaunay_from_points()</code></a></li>
<li><a class="reference internal" href="../../../reference/generated/compas.topology.voronoi_from_delaunay.html#compas.topology.voronoi_from_delaunay" title="compas.topology.voronoi_from_delaunay"><code class="xref py py-func docutils literal">compas.topology.voronoi_from_delaunay()</code></a></li>
</ul>
<div class="highlight"><pre><code class="language-python border rounded"><span></span><span class="c1"># delaunay and voronoi</span>

<span class="kn">from</span> <span class="nn">compas.datastructures</span> <span class="kn">import</span> <span class="n">Mesh</span>
<span class="kn">from</span> <span class="nn">compas.plotters</span> <span class="kn">import</span> <span class="n">MeshPlotter</span>

<span class="kn">from</span> <span class="nn">compas.topology</span> <span class="kn">import</span> <span class="n">trimesh_remesh</span>
<span class="kn">from</span> <span class="nn">compas.topology</span> <span class="kn">import</span> <span class="n">delaunay_from_points</span>
<span class="kn">from</span> <span class="nn">compas.topology</span> <span class="kn">import</span> <span class="n">voronoi_from_delaunay</span>

<span class="kn">from</span> <span class="nn">compas.geometry</span> <span class="kn">import</span> <span class="n">pointcloud_xy</span>


<span class="c1"># create a 2D pointcloud</span>
<span class="c1"># and generate a delaunay triangulation from it</span>
<span class="c1"># remesh the triagulation</span>
<span class="c1"># to give it a more even distribution of edges</span>
<span class="c1"># extract the points</span>
<span class="c1"># and generate the delaunay again</span>
<span class="c1"># generate a voronoi from that delaunay</span>

<span class="n">points</span>   <span class="o">=</span> <span class="n">pointcloud_xy</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">delaunay</span> <span class="o">=</span> <span class="n">delaunay_from_points</span><span class="p">(</span><span class="n">Mesh</span><span class="p">,</span> <span class="n">points</span><span class="p">)</span>

<span class="n">trimesh_remesh</span><span class="p">(</span><span class="n">delaunay</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">kmax</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">allow_boundary_split</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">points</span>   <span class="o">=</span> <span class="p">[</span><span class="n">delaunay</span><span class="o">.</span><span class="n">vertex_coordinates</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">delaunay</span><span class="o">.</span><span class="n">vertices</span><span class="p">()]</span>
<span class="n">delaunay</span> <span class="o">=</span> <span class="n">delaunay_from_points</span><span class="p">(</span><span class="n">Mesh</span><span class="p">,</span> <span class="n">points</span><span class="p">)</span>
<span class="n">voronoi</span>  <span class="o">=</span> <span class="n">voronoi_from_delaunay</span><span class="p">(</span><span class="n">delaunay</span><span class="p">)</span>


<span class="c1"># make a plotter for visualization</span>
<span class="c1"># draw the voronoi as lines</span>
<span class="c1"># on top of the delaunay</span>

<span class="n">plotter</span> <span class="o">=</span> <span class="n">MeshPlotter</span><span class="p">(</span><span class="n">delaunay</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">voronoi</span><span class="o">.</span><span class="n">edges</span><span class="p">():</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">'start'</span><span class="p">:</span> <span class="n">voronoi</span><span class="o">.</span><span class="n">vertex_coordinates</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="s1">'xy'</span><span class="p">),</span>
        <span class="s1">'end'</span>  <span class="p">:</span> <span class="n">voronoi</span><span class="o">.</span><span class="n">vertex_coordinates</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s1">'xy'</span><span class="p">),</span>
        <span class="s1">'width'</span><span class="p">:</span> <span class="mf">1.0</span>
    <span class="p">})</span>

<span class="n">plotter</span><span class="o">.</span><span class="n">draw_lines</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

<span class="n">plotter</span><span class="o">.</span><span class="n">draw_vertices</span><span class="p">(</span>
    <span class="n">radius</span><span class="o">=</span><span class="mf">0.075</span><span class="p">,</span>
    <span class="n">facecolor</span><span class="o">=</span><span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="s1">'#0092d2'</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">delaunay</span><span class="o">.</span><span class="n">vertices</span><span class="p">()</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">delaunay</span><span class="o">.</span><span class="n">vertices_on_boundary</span><span class="p">()}</span>
<span class="p">)</span>

<span class="n">plotter</span><span class="o">.</span><span class="n">draw_edges</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">'#cccccc'</span><span class="p">)</span>

<span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<ul class="simple">
<li><a class="reference internal" href="../../../reference/generated/compas.topology.dijkstra_path.html#compas.topology.dijkstra_path" title="compas.topology.dijkstra_path"><code class="xref py py-func docutils literal">compas.topology.dijkstra_path()</code></a></li>
</ul>
<div class="highlight"><pre><code class="language-python border rounded"><span></span><span class="c1"># shortest path</span>

<span class="kn">import</span> <span class="nn">compas</span>

<span class="kn">from</span> <span class="nn">compas.datastructures</span> <span class="kn">import</span> <span class="n">Network</span>
<span class="kn">from</span> <span class="nn">compas.plotters</span> <span class="kn">import</span> <span class="n">NetworkPlotter</span>

<span class="kn">from</span> <span class="nn">compas.topology</span> <span class="kn">import</span> <span class="n">dijkstra_path</span>


<span class="c1"># make a network from an irregular grid of lines</span>
<span class="c1"># extract an adjacency dictionary</span>
<span class="c1"># set the weight of each edge equal to its length</span>

<span class="n">network</span> <span class="o">=</span> <span class="n">Network</span><span class="o">.</span><span class="n">from_obj</span><span class="p">(</span><span class="n">compas</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'grid_irregular.obj'</span><span class="p">))</span>

<span class="n">adjacency</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">network</span><span class="o">.</span><span class="n">vertex_neighbours</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">vertices</span><span class="p">()}</span>

<span class="n">weight</span> <span class="o">=</span> <span class="p">{(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span> <span class="n">network</span><span class="o">.</span><span class="n">edge_length</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">edges</span><span class="p">()}</span>
<span class="n">weight</span><span class="o">.</span><span class="n">update</span><span class="p">({(</span><span class="n">v</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span> <span class="n">weight</span><span class="p">[(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)]</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">edges</span><span class="p">()})</span>

<span class="c1"># make a few edges heavier</span>
<span class="c1"># for example to simulate traffic problems</span>

<span class="c1"># heavy = [(7, 17), (9, 19)]</span>

<span class="c1"># for u, v in heavy:</span>
<span class="c1">#     weight[(u, v)] = 1000.0</span>
<span class="c1">#     weight[(v, u)] = 1000.0</span>


<span class="c1"># make an interactive plotter</span>
<span class="c1"># for finding shortest paths from a given start to a given end</span>
<span class="c1"># and through an additional user-selected point</span>

<span class="n">plotter</span> <span class="o">=</span> <span class="n">NetworkPlotter</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>


<span class="c1"># choose start and end</span>
<span class="c1"># and set an initial value for the via point</span>

<span class="n">start</span> <span class="o">=</span> <span class="mi">21</span>
<span class="n">via</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">end</span> <span class="o">=</span> <span class="mi">22</span>


<span class="c1"># define the function that computes the shortest path</span>
<span class="c1"># based on the current via</span>

<span class="k">def</span> <span class="nf">via_via</span><span class="p">(</span><span class="n">via</span><span class="p">):</span>

    <span class="c1"># compute the shortest path from start to via</span>
    <span class="c1"># and from via to end</span>
    <span class="c1"># combine the paths</span>

    <span class="n">path1</span> <span class="o">=</span> <span class="n">dijkstra_path</span><span class="p">(</span><span class="n">adjacency</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">via</span><span class="p">)</span>
    <span class="n">path2</span> <span class="o">=</span> <span class="n">dijkstra_path</span><span class="p">(</span><span class="n">adjacency</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">via</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">path1</span> <span class="o">+</span> <span class="n">path2</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">]:</span>
            <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="p">,</span> <span class="n">u</span>
        <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">])</span>


    <span class="c1"># update the plot</span>

    <span class="n">vertexcolor</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">vertexcolor</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'#00ff00'</span>
    <span class="n">vertexcolor</span><span class="p">[</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'#00ff00'</span>
    <span class="n">vertexcolor</span><span class="p">[</span><span class="n">via</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'#0000ff'</span>

    <span class="n">plotter</span><span class="o">.</span><span class="n">clear_vertices</span><span class="p">()</span>
    <span class="n">plotter</span><span class="o">.</span><span class="n">clear_edges</span><span class="p">()</span>

    <span class="n">plotter</span><span class="o">.</span><span class="n">draw_vertices</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">via</span><span class="p">,</span> <span class="n">end</span><span class="p">)},</span>
                          <span class="n">textcolor</span><span class="o">=</span><span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="s1">'#ffffff'</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]},</span>
                          <span class="n">facecolor</span><span class="o">=</span><span class="n">vertexcolor</span><span class="p">,</span>
                          <span class="n">radius</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span>
                          <span class="n">picker</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="n">plotter</span><span class="o">.</span><span class="n">draw_edges</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="p">{(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span> <span class="s1">'#ff0000'</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">},</span>
                       <span class="n">width</span><span class="o">=</span><span class="p">{(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span> <span class="mf">4.0</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">},</span>
                       <span class="n">text</span><span class="o">=</span><span class="p">{(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span> <span class="s1">'{:.1f}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">weight</span><span class="p">[(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)])</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">edges</span><span class="p">()},</span>
                       <span class="n">fontsize</span><span class="o">=</span><span class="mf">4.0</span><span class="p">)</span>


<span class="c1"># define a listener for picking points</span>
<span class="c1"># whenever a new point is picked</span>
<span class="c1"># it will call the via_via function</span>
<span class="c1"># with the picked point as via point</span>

<span class="n">index_key</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">index_key</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">on_pick</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">ind</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">via</span> <span class="o">=</span> <span class="n">index_key</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="n">via_via</span><span class="p">(</span><span class="n">via</span><span class="p">)</span>
    <span class="n">plotter</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>


<span class="c1"># initialize</span>
<span class="c1"># and start</span>

<span class="n">via_via</span><span class="p">(</span><span class="n">via</span><span class="p">)</span>

<span class="n">plotter</span><span class="o">.</span><span class="n">register_listener</span><span class="p">(</span><span class="n">on_pick</span><span class="p">)</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

</div>
<div class="section">
<h2>Numerical</h2>
<ul class="simple">
<li><a class="reference internal" href="../../../reference/generated/compas.numerical.fd.html#compas.numerical.fd" title="compas.numerical.fd"><code class="xref py py-func docutils literal">compas.numerical.fd()</code></a></li>
</ul>
<div class="highlight"><pre><code class="language-python border rounded"><span></span><span class="c1"># form finding</span>

<span class="kn">import</span> <span class="nn">compas</span>

<span class="kn">from</span> <span class="nn">compas.datastructures</span> <span class="kn">import</span> <span class="n">Mesh</span>
<span class="kn">from</span> <span class="nn">compas.plotters</span> <span class="kn">import</span> <span class="n">MeshPlotter</span>
<span class="kn">from</span> <span class="nn">compas.numerical</span> <span class="kn">import</span> <span class="n">fd</span>
<span class="kn">from</span> <span class="nn">compas.utilities</span> <span class="kn">import</span> <span class="n">i_to_rgb</span>


<span class="c1"># make a mesh from sample data</span>
<span class="c1"># set the default attributes of edges and vertices</span>
<span class="c1"># mark the corners as fixed</span>
<span class="c1"># store the original line geometry for plotting later</span>

<span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_obj</span><span class="p">(</span><span class="n">compas</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'faces.obj'</span><span class="p">))</span>

<span class="n">mesh</span><span class="o">.</span><span class="n">update_default_vertex_attributes</span><span class="p">({</span><span class="s1">'is_anchor'</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="s1">'px'</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">'py'</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">'pz'</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">})</span>
<span class="n">mesh</span><span class="o">.</span><span class="n">update_default_edge_attributes</span><span class="p">({</span><span class="s1">'q'</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">})</span>

<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">(</span><span class="bp">True</span><span class="p">):</span>
    <span class="n">attr</span><span class="p">[</span><span class="s1">'is_anchor'</span><span class="p">]</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vertex_degree</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>

<span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">mesh</span><span class="o">.</span><span class="n">edges</span><span class="p">():</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">'start'</span> <span class="p">:</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vertex_coordinates</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="s1">'xy'</span><span class="p">),</span>
        <span class="s1">'end'</span>   <span class="p">:</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vertex_coordinates</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s1">'xy'</span><span class="p">),</span>
        <span class="s1">'color'</span> <span class="p">:</span> <span class="s1">'#cccccc'</span><span class="p">,</span>
        <span class="s1">'width'</span> <span class="p">:</span> <span class="mf">1.0</span>
    <span class="p">})</span>


<span class="c1"># process the mesh data</span>
<span class="c1"># into a computation-friendly format</span>
<span class="c1"># i.e. convert everything to lists</span>
<span class="c1"># such that the force density method can convert it into fast Numpy arrays</span>

<span class="n">k_i</span>   <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">key_index</span><span class="p">()</span>
<span class="n">xyz</span>   <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">get_vertices_attributes</span><span class="p">((</span><span class="s1">'x'</span><span class="p">,</span> <span class="s1">'y'</span><span class="p">,</span> <span class="s1">'z'</span><span class="p">))</span>
<span class="n">loads</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">get_vertices_attributes</span><span class="p">((</span><span class="s1">'px'</span><span class="p">,</span> <span class="s1">'py'</span><span class="p">,</span> <span class="s1">'pz'</span><span class="p">))</span>
<span class="n">q</span>     <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">get_edges_attribute</span><span class="p">(</span><span class="s1">'q'</span><span class="p">)</span>
<span class="n">fixed</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vertices_where</span><span class="p">({</span><span class="s1">'is_anchor'</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
<span class="n">fixed</span> <span class="o">=</span> <span class="p">[</span><span class="n">k_i</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">fixed</span><span class="p">]</span>
<span class="n">edges</span> <span class="o">=</span> <span class="p">[(</span><span class="n">k_i</span><span class="p">[</span><span class="n">u</span><span class="p">],</span> <span class="n">k_i</span><span class="p">[</span><span class="n">v</span><span class="p">])</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">mesh</span><span class="o">.</span><span class="n">edges</span><span class="p">()]</span>


<span class="c1"># run the force density method</span>
<span class="c1"># update the mesh with the result</span>

<span class="n">xyz</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">fd</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">edges</span><span class="p">,</span> <span class="n">fixed</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">loads</span><span class="p">,</span> <span class="n">rtype</span><span class="o">=</span><span class="s1">'list'</span><span class="p">)</span>

<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">(</span><span class="bp">True</span><span class="p">):</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">k_i</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="n">attr</span><span class="p">[</span><span class="s1">'x'</span><span class="p">]</span> <span class="o">=</span> <span class="n">xyz</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">attr</span><span class="p">[</span><span class="s1">'y'</span><span class="p">]</span> <span class="o">=</span> <span class="n">xyz</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">attr</span><span class="p">[</span><span class="s1">'z'</span><span class="p">]</span> <span class="o">=</span> <span class="n">xyz</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="bp">True</span><span class="p">)):</span>
    <span class="n">attr</span><span class="p">[</span><span class="s1">'f'</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>


<span class="c1"># make a plotter</span>
<span class="c1"># visualize the original geometry</span>
<span class="c1"># and the equilibrium shape</span>
<span class="c1"># and set the thickness and color of edges</span>
<span class="c1"># proportional to the axial force</span>

<span class="n">plotter</span> <span class="o">=</span> <span class="n">MeshPlotter</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>

<span class="n">zmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">get_vertices_attribute</span><span class="p">(</span><span class="s1">'z'</span><span class="p">))</span>
<span class="n">fmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">get_edges_attribute</span><span class="p">(</span><span class="s1">'f'</span><span class="p">))</span>

<span class="n">plotter</span><span class="o">.</span><span class="n">draw_lines</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

<span class="n">plotter</span><span class="o">.</span><span class="n">draw_vertices</span><span class="p">()</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">draw_faces</span><span class="p">()</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">draw_edges</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="p">{(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">attr</span><span class="p">[</span><span class="s1">'f'</span><span class="p">]</span> <span class="o">/</span> <span class="n">fmax</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">mesh</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="bp">True</span><span class="p">)},</span>
    <span class="n">color</span><span class="o">=</span><span class="p">{(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span> <span class="n">i_to_rgb</span><span class="p">(</span><span class="n">attr</span><span class="p">[</span><span class="s1">'f'</span><span class="p">]</span> <span class="o">/</span> <span class="n">fmax</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">mesh</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="bp">True</span><span class="p">)},</span>
<span class="p">)</span>

<span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

</div>
<div class="section">
<h2>CAD integration</h2>
<ul class="simple">
<li><a class="reference internal" href="../../../reference/generated/compas.topology.mesh_subdivide.html#compas.topology.mesh_subdivide" title="compas.topology.mesh_subdivide"><code class="xref py py-func docutils literal">compas.topology.mesh_subdivide()</code></a></li>
<li><a class="reference internal" href="../../../reference/generated/compas.topology.mesh_subdivide_doosabin.html#compas.topology.mesh_subdivide_doosabin" title="compas.topology.mesh_subdivide_doosabin"><code class="xref py py-func docutils literal">compas.topology.mesh_subdivide_doosabin()</code></a></li>
<li><a class="reference internal" href="../../../reference/generated/compas.topology.mesh_subdivide_catmullclark.html#compas.topology.mesh_subdivide_catmullclark" title="compas.topology.mesh_subdivide_catmullclark"><code class="xref py py-func docutils literal">compas.topology.mesh_subdivide_catmullclark()</code></a></li>
<li><a class="reference internal" href="../../../reference/compas_rhino.html#module-compas_rhino" title="compas_rhino"><code class="xref py py-mod docutils literal">compas_rhino</code></a></li>
</ul>
<div class="highlight"><pre><code class="language-python border rounded"><span></span><span class="kn">from</span> <span class="nn">compas.datastructures</span> <span class="kn">import</span> <span class="n">Mesh</span>
<span class="kn">from</span> <span class="nn">compas.topology</span> <span class="kn">import</span> <span class="n">mesh_subdivide_doosabin</span>
<span class="kn">from</span> <span class="nn">compas.viewers</span> <span class="kn">import</span> <span class="n">SubdMeshViewer</span>

<span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_polyhedron</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

<span class="n">viewer</span> <span class="o">=</span> <span class="n">SubdMeshViewer</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">subdfunc</span><span class="o">=</span><span class="n">mesh_subdivide_doosabin</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>

<span class="n">viewer</span><span class="o">.</span><span class="n">axes_on</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">viewer</span><span class="o">.</span><span class="n">grid_on</span> <span class="o">=</span> <span class="bp">False</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">viewer</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">zoom_in</span><span class="p">()</span>

<span class="n">viewer</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
<span class="n">viewer</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<div class="highlight"><pre><code class="language-python border rounded"><span></span><span class="kn">from</span> <span class="nn">compas.datastructures</span> <span class="kn">import</span> <span class="n">Mesh</span>
<span class="kn">from</span> <span class="nn">compas.topology</span> <span class="kn">import</span> <span class="n">mesh_subdivide_catmullclark</span>

<span class="kn">import</span> <span class="nn">compas_rhino</span>

<span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_polyhedron</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="n">subd</span> <span class="o">=</span> <span class="n">mesh_subdivide_catmullclark</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="n">compas_rhino</span><span class="o">.</span><span class="n">mesh_draw_faces</span><span class="p">(</span>
    <span class="n">subd</span><span class="p">,</span>
    <span class="n">join_faces</span><span class="o">=</span><span class="bp">True</span>
<span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><code class="language-python border rounded"><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>

<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="kn">import</span> <span class="nn">compas_rhino</span>

<span class="kn">from</span> <span class="nn">compas.datastructures</span> <span class="kn">import</span> <span class="n">Mesh</span>
<span class="kn">from</span> <span class="nn">compas.topology</span> <span class="kn">import</span> <span class="n">mesh_subdivide</span>


<span class="c1"># make a control mesh</span>

<span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_polyhedron</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>


<span class="c1"># give it a name</span>
<span class="c1"># and set default vertex attributes</span>

<span class="n">mesh</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'Control'</span>
<span class="n">mesh</span><span class="o">.</span><span class="n">update_default_vertex_attributes</span><span class="p">({</span><span class="s1">'is_fixed'</span><span class="p">:</span> <span class="bp">False</span><span class="p">})</span>


<span class="c1"># make a partial function out of compas_rhino.mesh_draw</span>
<span class="c1"># (a function with some of the parameters already filled in)</span>
<span class="c1"># that can be used more easily to redraw the mesh</span>
<span class="c1"># with the same settings in the update loop</span>

<span class="n">draw</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
    <span class="n">compas_rhino</span><span class="o">.</span><span class="n">mesh_draw</span><span class="p">,</span>
    <span class="n">layer</span><span class="o">=</span><span class="s1">'SubdModeling::Control'</span><span class="p">,</span>
    <span class="n">clear_layer</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">show_faces</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">show_vertices</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">show_edges</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>


<span class="c1"># draw the control mesh</span>
<span class="c1"># with showing the faces</span>

<span class="n">draw</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>


<span class="c1"># allow the user to change the attributes of the vertices</span>
<span class="c1"># note: the interaction loop exits</span>
<span class="c1">#       when the user cancels the selection of mesh vertices</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="n">compas_rhino</span><span class="o">.</span><span class="n">mesh_select_vertices</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">keys</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="n">compas_rhino</span><span class="o">.</span><span class="n">mesh_update_vertex_attributes</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">keys</span><span class="p">)</span>
    <span class="n">draw</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">vertexcolor</span><span class="o">=</span><span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="s1">'#ff0000'</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vertices_where</span><span class="p">({</span><span class="s1">'is_fixed'</span><span class="p">:</span> <span class="bp">True</span><span class="p">})})</span>


<span class="c1"># make a subd mesh (using catmullclark)</span>
<span class="c1"># keep the vertices fixed</span>
<span class="c1"># as indicated by the user</span>

<span class="n">fixed</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vertices_where</span><span class="p">({</span><span class="s1">'is_fixed'</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
<span class="n">subd</span> <span class="o">=</span> <span class="n">mesh_subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">scheme</span><span class="o">=</span><span class="s1">'catmullclark'</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">fixed</span><span class="o">=</span><span class="n">fixed</span><span class="p">)</span>


<span class="c1"># give the mesh a (different) name</span>

<span class="n">subd</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'Mesh'</span>


<span class="c1"># draw the result</span>

<span class="n">compas_rhino</span><span class="o">.</span><span class="n">mesh_draw_faces</span><span class="p">(</span>
    <span class="n">subd</span><span class="p">,</span>
    <span class="n">layer</span><span class="o">=</span><span class="s1">'SubdModeling::Mesh'</span><span class="p">,</span>
    <span class="n">clear_layer</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">join_faces</span><span class="o">=</span><span class="bp">True</span>
<span class="p">)</span>
</code></pre></div>

</div>
</div>
<!--<nav class="compas-sideways">
                            
                                <a href="python.html" class="btn btn-primary compas-prev" role="button">Python</a>
                            

                            
                                <a href="../day2.html" class="btn btn-primary compas-next" role="button">Day 2</a>
                            
                        </nav>-->
</main>
<div class="col-12 col-md-3 col-xl-2 compas-sidebar" role="navigation">
<div class="navbar-light">
<form action="../../../search.html" class="d-flex compas-searchbox" id="" method="get">
<input class="form-control" name="q" placeholder="Search docs" type="text"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
<button aria-controls="compas-navigation" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler d-md-none compas-navigation-toggler" data-target="#compas-navigation" data-toggle="collapse" type="button">
<span class="navbar-toggler-icon"></span>
</button>
</form>
<div class="navbar-expand-md">
<div class="collapse navbar-collapse compas-navigation" id="compas-navigation">
<ul class="nav flex-column active">
<li class="nav-item"><a class="nav-link reference internal" href="../../../overview.html">Overview</a></li>
<li class="nav-item"><a class="nav-link reference internal" href="../../../examples.html">Examples</a></li>
<li class="nav-item"><a class="nav-link reference internal" href="../../../tutorial.html">Tutorial</a></li>
<li class="nav-item"><a class="nav-link reference internal" href="../../../reference.html">API Reference</a></li>
<li class="nav-item active"><a class="nav-link reference internal" href="../../../workshops.html">Workshops</a><ul class="nav active">
<li class="nav-item active"><a class="nav-link reference internal" href="../../acadia2017.html">ACADIA 2017</a><ul class="nav active">
<li class="nav-item active"><a class="nav-link reference internal" href="../day1.html">Day 1</a></li>
<li class="nav-item"><a class="nav-link reference internal" href="../day2.html">Day 2</a></li>
<li class="nav-item"><a class="nav-link reference internal" href="../day3.html">Day 3</a></li>
</ul>
</li>
</ul>
</li>
<li class="nav-item"><a class="nav-link reference internal" href="../../../bibliography.html">Bibliography</a></li>
</ul>
</div>
</div>
</div>
</div>
<div class="d-none d-xl-block col-xl-2 compas-toc" role="toc">
<ul class="nav flex-column" id="compas-localnav">
<li class="nav-item"><a class="nav-link reference internal" href="#">Datastructures</a><ul class="nav">
<li class="nav-item"><a class="nav-link reference internal" href="#network-mesh-volmesh">Network, Mesh, VolMesh</a></li>
<li class="nav-item"><a class="nav-link reference internal" href="#construction">Construction</a></li>
<li class="nav-item"><a class="nav-link reference internal" href="#access">Access</a></li>
<li class="nav-item"><a class="nav-link reference internal" href="#topology">Topology</a></li>
<li class="nav-item"><a class="nav-link reference internal" href="#geometry">Geometry</a></li>
<li class="nav-item"><a class="nav-link reference internal" href="#algorithms">Algorithms</a></li>
<li class="nav-item"><a class="nav-link reference internal" href="#numerical">Numerical</a></li>
<li class="nav-item"><a class="nav-link reference internal" href="#cad-integration">CAD integration</a></li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<footer class="compas-footer">
            
                
                    Â© Copyright 2017, Block Research Group - ETH Zurich.
                
            

            
                Last updated on Nov 08, 2017.
            

            
                Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.1.
            
        </footer>
<script type="text/javascript">
var DOCUMENTATION_OPTIONS = {
    URL_ROOT: '',
    VERSION: '',
    COLLAPSE_INDEX: false,
    FILE_SUFFIX: '.html',
    HAS_SOURCE: true,
    SOURCELINK_SUFFIX: '.txt'
};
            </script>
<script crossorigin="anonymous" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script crossorigin="anonymous" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
<script crossorigin="anonymous" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.0.0/anchor.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js"></script>
<script src="/static/underscore.js"></script>
<script src="/static/doctools.js"></script>
<script src="https://compas-dev.github.io/main/static/searchtools_.js"></script>
<script>
hljs.initHighlightingOnLoad();
anchors.add();

var pre = document.getElementsByTagName('pre');

for (var i = 0; i < pre.length; i++) {

    var is_code = pre[i].children[0].className.indexOf('language-python');

    if (is_code === 0) {

        var button = document.createElement('button');

        button.className = 'btn btn-secondary copy-code mt-4';
        button.textContent = 'Copy code';
        button.type = 'button';

        pre[i].appendChild(button);
    }
}

var copy_code = new Clipboard('.copy-code', {
    target: function(trigger) {
        return trigger.previousElementSibling;
    }
});

copy_code.on('success', function(event) {
    event.clearSelection();
    event.trigger.textContent = 'Copied!';
    window.setTimeout(function() {
        event.trigger.textContent = 'Copy code';
    }, 2000);
});

copy_code.on('error', function(event) { 
    event.trigger.textContent = 'Press "Ctrl + C" to copy...';
    window.setTimeout(function() {
        event.trigger.textContent = 'Copy code';
    }, 2000);
});
            </script>
</body>
</html>